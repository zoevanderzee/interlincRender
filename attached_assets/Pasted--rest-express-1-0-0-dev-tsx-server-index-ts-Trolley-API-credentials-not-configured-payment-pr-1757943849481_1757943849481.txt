
> rest-express@1.0.0 dev
> tsx server/index.ts

Trolley API credentials not configured - payment processing will be disabled
Trolley API credentials not configured
Logger initialized
1:35:34 PM [express] [Database] Health checks scheduled every 300 seconds
Session configuration: {
  secret: 'HIDDEN',
  resave: false,
  saveUninitialized: false,
  name: 'interlinc.sid',
  cookie: { secure: false, maxAge: 604800000, httpOnly: true, sameSite: 'lax' },
  storePresent: true
}
Session store initialized, keeping existing sessions
Session configuration: {
  secret: 'HIDDEN',
  resave: false,
  saveUninitialized: false,
  name: 'interlinc.sid',
  cookie: { secure: false, maxAge: 604800000, httpOnly: true, sameSite: 'lax' },
  storePresent: true
}
Session store initialized, keeping existing sessions
1:35:35 PM [express] serving on port 5000
1:35:35 PM [express] [Database] Health check: OK
Browserslist: browsers data (caniuse-lite) is 11 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
Auth check for session: bLkq3bgSexxkPDiXhCp6kCBFiYpOuUYO Authenticated: false
User API request headers: {
  cookie: undefined,
  'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.2 Safari/605.1.15',
  'x-user-id': undefined,
  'x-firebase-uid': undefined
}
1:35:44 PM [express] GET /api/user 401 in 3ms :: {"error":"Not authenticated"}
[2025-09-15T13:36:04.229Z] Database health check: OK
[2025-09-15T13:36:34.229Z] Database health check: OK
[2025-09-15T13:37:04.229Z] Database health check: OK
[2025-09-15T13:37:34.232Z] Database health check: OK
[2025-09-15T13:38:04.231Z] Database health check: OK
User metadata synced for user ID 86 (zoevdzee)
ðŸš¨ CRITICAL: No existing user found for email zoevdzee@creativlinc.co.uk or Firebase UID K1L54cjRphbhPRntEzvGW3kQUjh2
This should not happen for existing business users - check for account corruption
Serializing user: 86
âœ… Secure Passport session created for user 86
Sync Firebase user error: error: duplicate key value violates unique constraint "users_username_unique"
    at file:///home/runner/workspace/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async NeonPreparedQuery.execute (/home/runner/workspace/node_modules/src/neon-serverless/session.ts:102:18)
    at async DatabaseStorage.createUser (/home/runner/workspace/server/storage.ts:1371:20)
    at async <anonymous> (/home/runner/workspace/server/routes/sync-firebase-user.ts:74:23) {
  length: 215,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (username)=(zoevdzee) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'users',
  column: undefined,
  dataType: undefined,
  constraint: 'users_username_unique',
  file: 'nbtinsert.c',
  line: '666',
  routine: '_bt_check_unique'
}
node:_http_outgoing:655
    throw new ERR_HTTP_HEADERS_SENT('set');
          ^

Error [ERR_HTTP_HEADERS_SENT]: Cannot set headers after they are sent to the client
    at ServerResponse.setHeader (node:_http_outgoing:655:11)
    at ServerResponse.header (/home/runner/workspace/node_modules/express/lib/response.js:794:10)
    at ServerResponse.send (/home/runner/workspace/node_modules/express/lib/response.js:174:12)
    at ServerResponse.json (/home/runner/workspace/node_modules/express/lib/response.js:278:15)
    at ServerResponse.res.json (/home/runner/workspace/server/index.ts:30:28)
    at <anonymous> (/home/runner/workspace/server/routes/sync-firebase-user.ts:100:30)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  code: 'ERR_HTTP_HEADERS_SENT'
}

Node.js v20.19.3