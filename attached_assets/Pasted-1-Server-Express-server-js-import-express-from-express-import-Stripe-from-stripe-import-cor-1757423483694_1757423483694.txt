1. Server (Express)
server.js
import express from "express";
import Stripe from "stripe";
import cors from "cors";

const app = express();
app.use(cors());
app.use(express.json());

// IMPORTANT: replace with your *secret* key (sk_live_…)
const stripe = new Stripe("sk_live_xxxxxxxxxxxxxxxxxxxxx", {
  apiVersion: "2024-06-20",
});

// One endpoint: create account (if needed) + account session
app.post("/create-account-session", async (req, res) => {
  try {
    let { accountId } = req.body;

    // If no accountId was provided, create a new connected account
    if (!accountId) {
      const account = await stripe.accounts.create({
        type: "custom",
        country: "US", // change to your users’ country
        capabilities: {
          card_payments: { requested: true },
          transfers: { requested: true },
        },
      });
      accountId = account.id;
    }

    // Create an Account Session for embedded onboarding
    const session = await stripe.accountSessions.create({
      account: accountId,
      components: { account_onboarding: { enabled: true } },
    });

    res.json({ accountId, client_secret: session.client_secret });
  } catch (err) {
    console.error(err);
    res.status(500).json({ error: err.message });
  }
});

app.listen(3000, () => console.log("Server running on http://localhost:3000"));
2. Client (React)
Install the Stripe package:
npm install @stripe/connect-js
client/src/pages/ConnectOnboarding.tsx
import { useEffect, useRef } from "react";
import { loadConnectAndInitialize } from "@stripe/connect-js";

const PUBLISHABLE_KEY =
  "pk_live_51R97qMF4bfRUGDn9PieolF5SKiBOF6YE9axkFFBBx4mLCA9PdhbC9bsolEvYknQ0KyHerJzsqKFW3dy900Osf9v300UKU3lUEk";

export default function ConnectOnboarding() {
  const containerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    (async () => {
      // 1. Ask the backend for account + session
      const resp = await fetch("http://localhost:3000/create-account-session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ accountId: null }), // send null if user has no acct yet
      });
      const { accountId, client_secret } = await resp.json();

      // 2. Initialize Stripe Connect.js
      const connect = await loadConnectAndInitialize({
        publishableKey: PUBLISHABLE_KEY,
        fetchClientSecret: async () => client_secret,
      });

      // 3. Mount the onboarding component (all inside your app)
      const onboarding = connect.create("account-onboarding");
      containerRef.current?.appendChild(onboarding);

      console.log("Embedded onboarding started for", accountId);
    })();
  }, []);

  return (
    <div>
      <h1>Embedded Onboarding</h1>
      <div ref={containerRef}></div>
    </div>
  );
}
3. Instructions for your agent
Add the backend route from server.js to your Express app.
Replace the placeholder sk_live_xxx with your real secret key.
Add the React component above to your client.
Replace the publishable key with your pk_live_… (already in the code).
Run server (node server.js) and client (npm run dev).
Visit the onboarding page → the embedded Stripe form appears inside your app.
✅ This will:
Create a connected account (if needed).
Create an Account Session.
Render the full embedded onboarding UI inside your app.
Allow the user to verify their identity without ever being redirected to Stripe.com.