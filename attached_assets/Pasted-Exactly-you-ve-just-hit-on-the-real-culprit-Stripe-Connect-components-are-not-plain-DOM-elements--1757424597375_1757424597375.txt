Exactly — you’ve just hit on the real culprit:
Stripe Connect components are not plain DOM elements. They’re like Stripe Elements: you can’t just appendChild() them. If you do, Connect.js can’t initialize its “data layer,” and it silently falls back to hosted onboarding → redirect.
✅ Correct way to mount
const onboarding = connect.create("account-onboarding");
onboarding.mount("#onboarding-container");
Where #onboarding-container is a plain <div> in your JSX.
❌ Wrong way (what was happening)
const onboarding = connect.create("account-onboarding");
containerRef.current?.appendChild(onboarding);
That bypasses Stripe’s lifecycle, triggers “data layer not initialized,” and the component fails → hosted fallback.
Fixed React component
import { useEffect } from "react";
import { loadConnectAndInitialize } from "@stripe/connect-js";

const PUBLISHABLE_KEY = "pk_live_XXXXXXXXXXXXXXXXXXXXXXXX";

export default function ConnectOnboarding() {
  useEffect(() => {
    (async () => {
      const resp = await fetch("http://localhost:3000/create-account-session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ accountId: null }),
      });
      const { client_secret } = await resp.json();

      const connect = await loadConnectAndInitialize({
        publishableKey: PUBLISHABLE_KEY,
        fetchClientSecret: async () => client_secret,
      });

      const onboarding = connect.create("account-onboarding");

      onboarding.on("ready", () => {
        console.log("Embedded onboarding component is ready");
      });

      onboarding.mount("#onboarding-container");
    })();
  }, []);

  return (
    <div>
      <h1>Embedded Onboarding</h1>
      <div id="onboarding-container" style={{ minHeight: 500 }} />
    </div>
  );
}
Key fixes
Use .mount("#selector"), not .appendChild().
Added .on("ready") listener → useful to confirm initialization.
Added style={{ minHeight: 500 }} so the container is visible (empty divs collapse).
Why this solves the redirect
With .mount(), Connect.js can attach its “data layer” (iframe, messaging, postMessage API).
With .appendChild(), it can’t, so it fails over to hosted onboarding.
That’s why you saw Data layer has not been initialized and multiple attempts to “create component.”